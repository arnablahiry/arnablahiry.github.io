import{M as c,r as h,j as l}from"./green-scanner-CKFFx0ZC.js";var g=Object.prototype.hasOwnProperty;function d(s,t){var e,n;if(s===t)return!0;if(s&&t&&(e=s.constructor)===t.constructor){if(e===Date)return s.getTime()===t.getTime();if(e===RegExp)return s.toString()===t.toString();if(e===Array){if((n=s.length)===t.length)for(;n--&&d(s[n],t[n]););return n===-1}if(!e||typeof s=="object"){n=0;for(e in s)if(g.call(s,e)&&++n&&!g.call(t,e)||!(e in t)||!d(s[e],t[e]))return!1;return Object.keys(t).length===n}}return s!==s&&t!==t}class a{static instance=null;stores;_widgetState=null;widgetStateListeners=new Set;_viewState={mode:"inline"};viewListeners=new Set;constructor(){this.stores=this.initializeStores()}static getInstance(){return a.instance||(a.instance=new a),a.instance}static resetInstance(){a.instance=null}getHostContextStore(t){return this.stores[t]}callTool=async(t,e)=>{const r=await c.getInstance().request({method:"tools/call",params:{name:t,arguments:e??void 0}}),i=r.content.filter(o=>o.type==="text").map(({text:o})=>o).join(`
`);return{content:r.content,structuredContent:r.structuredContent??{},isError:r.isError??!1,result:i,meta:r._meta??{}}};requestDisplayMode=t=>{const e=c.getInstance();if(t!=="modal")return e.request({method:"ui/request-display-mode",params:{mode:t}});throw new Error("Modal display mode is not accessible in MCP App.")};sendFollowUpMessage=async t=>{await c.getInstance().request({method:"ui/message",params:{role:"user",content:[{type:"text",text:t}]}})};openExternal(t){c.getInstance().request({method:"ui/open-link",params:{url:t}})}initializeStores(){return{theme:this.createHostContextStore(["theme"],({theme:t})=>t??"light"),locale:this.createHostContextStore(["locale"],({locale:t})=>t??"en-US"),safeArea:this.createHostContextStore(["safeAreaInsets"],({safeAreaInsets:t})=>({insets:t??{top:0,right:0,bottom:0,left:0}})),displayMode:this.createHostContextStore(["displayMode"],({displayMode:t})=>t??"inline"),maxHeight:this.createHostContextStore(["containerDimensions"],({containerDimensions:t})=>{if(t&&"maxHeight"in t)return t.maxHeight}),userAgent:this.createHostContextStore(["platform","deviceCapabilities"],({platform:t,deviceCapabilities:e})=>({device:{type:t==="web"?"desktop":t??"unknown"},capabilities:{hover:!0,touch:!0,...e}})),toolInput:this.createHostContextStore(["toolInput"],({toolInput:t})=>t??null),toolOutput:this.createHostContextStore(["toolResult"],({toolResult:t})=>t?.structuredContent??null),toolResponseMetadata:this.createHostContextStore(["toolResult"],({toolResult:t})=>t?._meta??null),view:{subscribe:t=>(this.viewListeners.add(t),()=>{this.viewListeners.delete(t)}),getSnapshot:()=>this._viewState},widgetState:{subscribe:t=>(this.widgetStateListeners.add(t),()=>{this.widgetStateListeners.delete(t)}),getSnapshot:()=>this._widgetState}}}setWidgetState=async t=>{const e=typeof t=="function"?t(this._widgetState):t;await c.getInstance().request({method:"ui/update-model-context",params:{structuredContent:e,content:[{type:"text",text:JSON.stringify(e)}]}}),this._widgetState=e,this.widgetStateListeners.forEach(r=>{r()})};uploadFile(){throw new Error("File upload is not supported in MCP App.")}getFileDownloadUrl(){throw new Error("File download is not supported in MCP App.")}openModal(t){this._viewState={mode:"modal",params:t.params},this.viewListeners.forEach(e=>{e()})}closeModal(){this._viewState={mode:"inline"},this.viewListeners.forEach(t=>{t()})}setOpenInAppUrl(t){throw new Error("setOpenInAppUrl is not implemented in MCP App.")}createHostContextStore(t,e){const n=c.getInstance();let r;return{subscribe:n.subscribe(t),getSnapshot:()=>{const i=Object.fromEntries(t.map(u=>[u,n.getSnapshot(u)])),o=e(i);return r!==void 0&&d(r,o)?r:(r=o,o)}}}}const p=`
.sb-modal-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.5);
  z-index: 9998;
}
.sb-modal-container {
  border-radius: 12px;
  position: fixed;
  inset: 0;
  margin: auto;
  width: fit-content;
  height: fit-content;
  background: white;
  z-index: 9999;
}
`;function w({children:s}){const t=a.getInstance(),{mode:e}=h.useSyncExternalStore(t.getHostContextStore("view").subscribe,t.getHostContextStore("view").getSnapshot),n=e==="modal",r=i=>{i.target===i.currentTarget&&t.closeModal()};return h.useEffect(()=>{if(!n)return;const i=o=>{o.key==="Escape"&&t.closeModal()};return document.addEventListener("keydown",i),()=>document.removeEventListener("keydown",i)},[n,t]),l.jsxs(l.Fragment,{children:[l.jsx("style",{children:p}),n&&l.jsx("div",{role:"dialog",className:"sb-modal-backdrop",onClick:r}),l.jsx("div",{className:n?"sb-modal-container":void 0,children:s})]})}export{w as ModalProvider};
